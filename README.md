Clinic Bookings Guy (CBG)
==================


CBG is an optimisation and learning system that is designed to assist the booking process for GenesisCare.


The system is designed to predict patient treatment times and cluster similar treatment types.

## Getting Started

The entry point into CBG is the `main.py` file and is run as

`python main.py start-date end-date`



Where **start-date** and **end-date** are dates that define the schedule date range to optimise in the format **YYYY-MM-DD**



The program takes several flags to adjust the execution of the program, such as:

*  -h (or --help) show the program usage.
*  --sims: Run the schedule simulations to show optimisation metrics. By default this is set to `False`
*  --prod: Run the program in **production mode** which changes the logging level and log file destination. 
By default this is set to `False`



## Prerequisites

CBG has a number of library dependencies to function correctly, such as:

*  [scikit-learn](http://scikit-learn.org/)
*  [seaborn](https://seaborn.pydata.org/)
*  [matplotlib](https://matplotlib.org/)
*  [numpy](http://www.numpy.org/)
*  [deap](https://deap.readthedocs.io/en/master/)
*  [pandas](https://pandas.pydata.org/)

It is recommended to install these dependencies using a package manager such as [pip](https://pypi.org/project/pip/). 
Through *pip* the process can by automated by running the following command.


`pip install -r requirements.txt`

The databases must be populated before the system can run, however due to the privacy concerns, the data is not provided.

The databases can be generated by running the scripts


`import_bookings.py` and `import_postcode.py`

## Importing Data

The databases schema provided are meant to be for testing/development. Instead the system is meant to be integrated directly with MOSAIQ.

However, if you want to use the testing database, it can be built by running `import_bookings.py` inside the `scripts` folder.

By default the script will import data from `schedule_v003.csv` 

## Output

CBG will write a CSV file for each location and for each day of the week. By default this is written to the `schedules/` directory.

The CSV file format is written as:

| Appointment Time | Patient ID | Activity Type | Estimated Treatment Time |

Where each appointment is divided into **5** minute intervals. 
For example, a patient with an estimated **30** minute treatment will have **6** rows in the CSV in order.

## Error Messages

**No treatment locations found for Patient**

No locations that can treat the patient's activity were found. The database needs to be checked to ensure that each machine has all the activities assigned.

Otherwise, the patient may not have a postcode assigned to them which is required to determine the most optimal clinic.

**Patient unable to be allocated to location**

This indicates that a patient wasn't able to be allocated to a location. This may be due to several factors:
*  No time remaining in the schedule for any available locations - Patient will need to be manually scheduled outside the clinic hours.
*  No locations that can treat the patient's activity were found.

**No lat/lon found for postcode**

Indicates that the patient may not have a postcode assigned or the postcode was not found in the postcode database.

Add a postcode to the patient or the database to resolve.

## Authors
[Macquarie University](https://www.mq.edu.au/) PACE Group 6
